{"version":3,"file":"NiubizRepository.js","sourceRoot":"","sources":["../../src/repositories/NiubizRepository.ts"],"names":[],"mappings":"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","sourcesContent":["import { InvokeCommand, LambdaClient } from \"@aws-sdk/client-lambda\";\nimport { fromUtf8 } from \"@aws-sdk/util-utf8\";\nimport { BaseRepository, BaseRepositoryProps } from \"./BaseRepository\";\nimport { HttpMethod } from \"../integration/assets/httpConstants\";\nimport { INiubiz } from \"./interfaces/INiubiz\";\n\nexport enum NiubizResource {\n  Niubiz = \"/niubiz\",\n  NiubizCardId = \"/cards/{cardId}\",\n}\n\nexport interface NiubizRepositoryProps extends BaseRepositoryProps {\n  lambdaClient: LambdaClient;\n  niubizLambda: string;\n}\n\nexport class CardsRepository extends BaseRepository {\n  constructor(protected props: NiubizRepositoryProps) {\n    super(props);\n  }\n\n  private async sendLambdaCommand(payload: object) {\n    const invokeCommand = new InvokeCommand({\n      FunctionName: this.props.niubizLambda,\n      Payload: fromUtf8(JSON.stringify(payload)),\n    });\n    const response = await this.props.lambdaClient.send(invokeCommand);\n    return this.processLambdaApiResponse(response);\n  }\n\n  async create(niubiz: INiubiz) {\n    const payload = {\n      resource: NiubizResource.Niubiz,\n      httpMethod: HttpMethod.POST,\n      requestContext: { identity: { sourceIp: niubiz.clientIp } },\n      headers: this.getInternetBankingHeaders({\n        customerId: niubiz.customerId,\n      }),\n      body: JSON.stringify({\n        transactionToken: \"\",\n      }),\n    };\n    return this.sendLambdaCommand(payload);\n  }\n\n  async findWithCustomerId(niubiz: INiubiz) {\n    const payload = {\n      resource: NiubizResource.Niubiz,\n      httpMethod: HttpMethod.GET,\n      requestContext: { identity: { sourceIp: niubiz.clientIp } },\n      headers: this.getInternetBankingHeaders({\n        customerId: niubiz.customerId,\n      }),\n    };\n    return this.sendLambdaCommand(payload);\n  }\n\n  async payment(niubiz: INiubiz) {\n    const payload = {\n      resource: NiubizResource.NiubizCardId,\n      httpMethod: HttpMethod.POST,\n      pathParameters: { cardId: niubiz.cardId },\n      requestContext: { identity: { sourceIp: niubiz.clientIp } },\n      headers: this.getInternetBankingHeaders({\n        customerId: niubiz.customerId,\n      }),\n      body: JSON.stringify({\n        amount: \"\",\n        purchaseNumber: \"\",\n      }),\n    };\n    return this.sendLambdaCommand(payload);\n  }\n\n  async delete(niubiz: INiubiz) {\n    const payload = {\n      resource: NiubizResource.NiubizCardId,\n      httpMethod: HttpMethod.DELETE,\n      pathParameters: { cardId: niubiz.cardId },\n      headers: this.getInternetBankingHeaders({\n        customerId: niubiz.customerId,\n      }),\n    };\n    return this.sendLambdaCommand(payload);\n  }\n}\n"]}